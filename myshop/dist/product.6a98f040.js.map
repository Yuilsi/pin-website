{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,yBCAAD,EAAAC,EAAA,mDDMA,MAAMC,EAAqBC,SAASC,eAAe,eAC7CC,EAAuBF,SAASC,eAAe,iBAErD,IAAIE,EAEAC,EAAO,GASXC,eAAeC,IACX,MAAMC,EARV,SAAkBC,GACd,MAAMC,EAAMC,OAAOC,SAASC,OAG5B,OAFqB,IAAIC,gBAAgBJ,GACVK,IAAIN,GAKjBO,CAAS,OAY/B,SAAuBC,GACnBd,EAAqBe,UAAY,6DAGJD,EAAWE,OAAA,OAA+Cd,EAAAe,MAAAC,GAAAA,EAAAC,KAAAL,EAAAK,KAStFtB,EACGkB,UAAA,mCAGsBD,EAASM,gDACjBN,EAAiBO,sDACXP,EAAAQ,mDACdC,EAAwBC,eAA+BV,EAAKW,6EAGlEX,EAAME,OAAAU,OAAe,YAuCtBV,GAEH,MAAAW,EAAA7B,SAAAC,eAAoB,aAEd6B,EAAA9B,SAAgB+B,cAAS,OAE/BD,EAAAE,UAAc,qBACVC,SAAYC,IAGbJ,EAAAb,WAAA,aAAAiB,SAGPhC,EAAAiC,YAAmBL,GACL9B,SAAAoC,cAAA,qBACRC,iBAAA,SAAAC,IACA,QAAAA,EAAAC,OAAAC,SAAAX,EAAAY,aAAA,MAA8DH,EAAAC,OAAAG,eAvDvCC,CAAA3B,EAAAE,gBACPlB,SAAAoC,cAAA,oBACAC,iBAAA,SAAyBhC,MAAAiC,MACtCM,iBAED,MAAIC,EAAuBzC,EAAA0C,MAAAC,GAAAA,EAAA1B,IAAA0B,EAAA1B,KACmD2B,EAAA,IAC1EhC,EACHiC,QACGJ,EAAKA,EAAmBI,QAAA,EAAA,GAO5B,GAAIJ,EAAA,CACA,MAAAK,EAAkB9C,EAAY+C,WAAoBJ,GAAAA,EAAA1B,IAAA0B,EAAA1B,KAElDjB,EAAgB8C,GAAAF,SACMI,KAAWJ,sBAC7B5C,OAEJiD,EAAApC,UAAA,mBACHoC,EAAAC,UAAA,EAEHC,YAAA,KACAF,EAAApC,UAAA,qBACCoC,EAAAC,UAAA,IACN,KAEQE,EAAAC,mBAAA5D,EAAA6D,GAAAvD,EAAAwD,IAAAvD,OAzDLwD,CALgB,UCtBpBvD,eAA0BgB,GACtB,MAAMwC,EAASC,EAAAC,IAAIlE,EAAA6D,GAAI,WAAYrC,GACnC,IAII,aAHsByC,EAAAE,OAAOH,IACRI,OAGvB,MAAM3B,GACJ4B,QAAQC,IAAI7B,IDYG8B,CAAW7D,GAI1Bc,GAAId,yBAuFMV,EAAAwE,MAAAhE,MAAAiE,IACZA,GASDnE,EAAAmE","sources":["src/scripts/product.js","src/scripts/functions/getProduct.js"],"sourcesContent":["import { db, auth } from \"./app\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport { getProduct } from \"./functions/getProduct\";\r\nimport { getFirebaseCart, createFirebaseCart } from \"./functions/cart\";\r\nimport { getMyLocalCart, addProductToCart, currencyFormat } from \"../utils\";\r\n\r\nconst productInfoSection = document.getElementById(\"productInfo\");\r\nconst productAssetsSection = document.getElementById(\"productAssets\");\r\n\r\nlet userLogged = undefined;\r\nlet products = [];\r\nlet cart = [];\r\n\r\nfunction getParam(param) {\r\n    const url = window.location.search;\r\n    const searchParams = new URLSearchParams(url);\r\n    const productId = searchParams.get(param);\r\n    return productId;\r\n}\r\n\r\nasync function loadProduct() {\r\n    const productId = getParam(\"id\"); // http://localhost:1234/product.html?id=TXQ9Wf1GIoAOJLkIEMYo&age=20\r\n\r\n    const data = await getProduct(productId);\r\n\r\n    const product = {\r\n        ...data,\r\n        id: productId, // docSnap.id,\r\n    }\r\n\r\n    renderProduct(product);\r\n}\r\n\r\nfunction renderProduct(product) {\r\n    productAssetsSection.innerHTML = `\r\n    <img class=\"product__mainImage\" id=\"mainImage\" src=\"${product.images[0]}\">`;\r\n\r\n    const isProductAddedToCart = cart.some((productCart) => productCart.id === product.id);\r\n\r\n    productInfoSection.innerHTML = `\r\n    <h1 class=\"product__name\">${product.name}</h1>\r\n    <h2 class=\"product__category\">${product.category}</h2>\r\n    <p class=\"product__description\">${product.description}</p>\r\n    <h3 class=\"product__price\">${currencyFormat(product.price)}</h3> \r\n    <button class=\"product__cart\">Añadir al carrito</button>`;\r\n\r\n    if (product.images.length > 1) {\r\n        createGallery(product.images);\r\n    }\r\n\r\n    const productCartButton = document.querySelector(\".product__cart\");\r\n    productCartButton.addEventListener(\"click\",async (e)=> {\r\n        e.preventDefault(); // evitar que al dar click en el boton, funcione el enlace del padre.\r\n        const currentProductIsAdded = cart.find(product => product.id === product.id);\r\n\r\n\r\n        const productToAdd = {\r\n            ...product,\r\n            counter: (currentProductIsAdded) ? currentProductIsAdded.counter + 1 : 1,\r\n        }\r\n\r\n        if (currentProductIsAdded) {\r\n            const indexElement = cart.findIndex(product => product.id === product.id);\r\n            cart[indexElement] = productToAdd;\r\n        } else {\r\n            cart.push(productToAdd);\r\n        }\r\n      \r\n      \r\n      \r\n        addProductToCart(cart);\r\n\r\n        if (userLogged) {\r\n            productCartButton.innerHTML = \"producto Añadido\";\r\n            productCartButton.disabled = true ;\r\n            setTimeout(()=> {\r\n                productCartButton.innerHTML= \"Agregar al carrito\";\r\n                productCartButton.disabled =false;\r\n            }, 100);\r\n            createFirebaseCart(db, userLogged.uid, cart);\r\n        }\r\n\r\n      //  productCartButton.setAttribute(\"disabled\", true);\r\n      //  productCartButton.innerText = \"Producto añadido\";\r\n    });\r\n}\r\n\r\nfunction createGallery(images) {\r\n    const mainImage = document.getElementById(\"mainImage\");\r\n\r\n    const gallery = document.createElement(\"div\");\r\n    gallery.className = \"product__gallery\";\r\n\r\n    images.forEach(image => {\r\n        gallery.innerHTML += `<img src=\"${image}\">`;\r\n    });\r\n\r\n    productAssetsSection.appendChild(gallery);\r\n\r\n    const galleryImages = document.querySelector(\".product__gallery\");\r\n\r\n    galleryImages.addEventListener(\"click\", e => {\r\n        if (e.target.tagName === \"IMG\") {\r\n            mainImage.setAttribute(\"src\", e.target.currentSrc);\r\n        }\r\n    });\r\n}\r\n\r\nonAuthStateChanged(auth, async (user) => {\r\n    if (user) {\r\n      // User is signed in, see docs for a list of available properties\r\n      // https://firebase.google.com/docs/reference/js/firebase.User\r\n      userLogged = user;\r\n      cart = await getFirebaseCart(db, userLogged.uid);\r\n      console.log(cart);\r\n      // ...\r\n    } else {\r\n        cart = getMyLocalCart();\r\n      // User is signed out\r\n      // ...\r\n    }\r\n\r\n    loadProduct();\r\n\r\n  });","import { db } from \"../app\";\r\nimport { doc, getDoc } from \"firebase/firestore\";\r\n\r\nasync function getProduct(id) {\r\n    const docRef = doc(db, \"products\", id);\r\n    try {\r\n        const docSnap = await getDoc(docRef);\r\n        const data = docSnap.data();\r\n    \r\n        return data; \r\n    } catch(e) {\r\n        console.log(e);\r\n    }\r\n}\r\n\r\nexport {\r\n    getProduct\r\n}"],"names":["$li1Mx","parcelRequire","$63445bb05f51f6f7$var$productInfoSection","document","getElementById","$63445bb05f51f6f7$var$productAssetsSection","$63445bb05f51f6f7$var$userLogged","$63445bb05f51f6f7$var$cart","async","$63445bb05f51f6f7$var$loadProduct","productId","param","url","window","location","search","URLSearchParams","get","$63445bb05f51f6f7$var$getParam","product1","innerHTML","images","some","productCart","id","name","category","description","$2EF88","currencyFormat","price","length","mainImage","gallery","createElement","className","forEach","image","appendChild","querySelector","addEventListener","e","target","tagName","setAttribute","currentSrc","$63445bb05f51f6f7$var$createGallery","preventDefault","currentProductIsAdded","find","product","productToAdd","counter","indexElement","findIndex","push","productCartButton","disabled","setTimeout","$hMt9z","createFirebaseCart","db","uid","$63445bb05f51f6f7$var$renderProduct","docRef","$etBjH","doc","getDoc","data","console","log","$96d763eed7c24a29$export$e2005c9600188ac7","auth","user"],"version":3,"file":"product.6a98f040.js.map"}